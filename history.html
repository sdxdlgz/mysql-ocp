<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>å†å²è®°å½• - MySQL OCP</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app">
    <div class="controls">
      <h2>å†å²è®°å½•</h2>
      <div>
        <button @click="view = 'history'" :class="{ active: view === 'history' }">è€ƒè¯•å†å²</button>
        <button @click="view = 'wrong'" :class="{ active: view === 'wrong' }">é”™é¢˜å›é¡¾</button>
        <a href="index.html" class="control-button" style="margin-left: 1rem;">è¿”å›ä¸»é¡µ</a>
      </div>
    </div>

    <div class="card" v-if="view === 'history'">
      <h3>è€ƒè¯•å†å²</h3>
      <div v-if="history.length === 0">
        <p>æš‚æ— å†å²è®°å½•</p>
      </div>
      <div v-else>
        <table>
          <thead>
            <tr>
              <th>è€ƒè¯•åç§°</th>
              <th>æ—¥æœŸ</th>
              <th>å¾—åˆ†</th>
              <th>ç»“æœ</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, index) in history" :key="index">
              <td>{{ item.title }}</td>
              <td>{{ new Date(item.date).toLocaleString() }}</td>
              <td>{{ calculateAccuracy(item).toFixed(2) }}%</td>
              <td :class="calculateAccuracy(item) >= 62 ? 'correct' : 'wrong'">
                {{ calculateAccuracy(item) >= 62 ? 'é€šè¿‡' : 'æœªé€šè¿‡' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card" v-if="view === 'wrong'">
      <h3>é”™é¢˜å›é¡¾</h3>
      <div v-if="wrongQuestions.length === 0" class="empty-state">
        <p>ğŸ‰ æ­å–œä½ ï¼Œæš‚æ— é”™é¢˜ï¼</p>
      </div>
      <div v-else>
        <div v-for="(question, index) in wrongQuestions" :key="index" class="box question-review">
          <p><strong>é¢˜ç›® {{ index + 1 }}:</strong></p>
          <div v-html="renderMarkdown(question.question)" class="question-body"></div>
          <div class="answer-summary">
            <p><strong>æ­£ç¡®ç­”æ¡ˆ:</strong> <span class="correct-answer">{{ question.answers.join(', ') }}</span></p>
            <p><strong>è§£æ:</strong></p>
            <div v-html="renderMarkdown(question.summary)"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://unpkg.com/vue@3.5.13/dist/vue.global.js"></script>
  <script src="https://unpkg.com/marked@15.0.11/marked.min.js"></script>
  <script>
    const app = Vue.createApp({
      data() {
        return {
          view: 'history', // 'history' or 'wrong'
          history: [],
          wrongQuestions: []
        };
      },
      created() {
        this.loadHistory();
        this.loadWrongQuestions();
      },
      methods: {
        loadHistory() {
          this.history = JSON.parse(localStorage.getItem('exam_history') || '[]');
        },
        loadWrongQuestions() {
          this.wrongQuestions = JSON.parse(localStorage.getItem('ocp_wrong_questions') || '[]');
        },
        calculateAccuracy(examResult) {
          let correctCount = 0;
          examResult.questions.forEach((q, index) => {
            const user = [...examResult.userAnswers[index]].sort();
            const correct = [...q.answers].sort();
            if (JSON.stringify(user) === JSON.stringify(correct)) {
              correctCount++;
            }
          });
          return (correctCount / examResult.questions.length) * 100;
        },
        renderMarkdown(markdown) {
          return marked.parse(markdown);
        }
      }
    });
    app.mount('#app');
  </script>
</body>

</html>